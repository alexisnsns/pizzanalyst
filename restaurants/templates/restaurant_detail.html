{% extends "base.html" %} {% load static %} {% block page_content %}
{% load crispy_forms_tags %}
{% load cloudinary %}
{% load mathfilters %}

<h1 class="text-center mb-4 mt-4">{{ restaurant.name|title }}</h1>
<div class="row">
  <div class="col-md-8">
    {% if image_url %}
    <img src="{{ image_url }}" alt="restaurant image" width="100%">
    {% else %}
    <img src="{% static 'frank.jpg' %}" alt="My image", width="100%">
    {% endif %}
  </div>
  <div class="col-md-4">
    <h5>About the restaurant:</h5>
    <p>{{ restaurant.description }}</p>
    <br>
    <h5>Address:</h5>
    <p>{{ restaurant.address }}</p>
    <h5>Cheapest slice (last reported):</h5>
    <p>${{ restaurant.comments.last.cheapestslice }}</p>
    <h5>User average grade:</h5>
    <p>{{ restaurant.average_quality }} / 5</p>
    <h5>Bang for buck:</h5>
    <p>{{ restaurant.average_quality|div:restaurant.comments.last.cheapestslice|floatformat:2 }}</p>


  {% comment %} UPDATE RESTAURANT {% endcomment %}
  <form method="POST" action="{% url 'restaurant_update' restaurant.pk %}">
    {% csrf_token %}
    <input type="submit" value="Update restaurant" class="btn btn-warning" />
  </form>

    {% comment %} DELETE RESTAURANT {% endcomment %}
  <form method="POST" action="{% url 'restaurant_delete' restaurant.pk %}">
    {% csrf_token %}
    <input type="submit" value="Delete restaurant" class="btn btn-danger" />
  </form>

</div>
</div>



<hr>

{% comment %} DISPLAY COMMENTS {% endcomment %}
<h1 class="text-center mb-4 mt-4"> Comments </h1>

  <div class="row">
    {% for comment in restaurant.comments.all %}
    <div class="col-md-4">
      <div class="card mb-2">
        <!-- <img class="card-img-top" src="{% static restaurant.image %}"> -->
        <div class="card-body">
          <h5 class="card-title">{{ comment.username|title }}</h5>
          <p class="card-text">{{ comment.body }}</p>
          <p class="card-text">{{ comment.quality }} / 5</p>
          <p class="card-text">{{ comment.cheapestslice }} $</p>
          <p class="card-text">{{ comment.created|date:"j / n / Y" }}</p>
          <form method="POST" action="{% url 'comment_update' pk=comment.pk %}">
            {% csrf_token %}
            <input type="submit" value="Update" class="btn btn-warning" />
          </form>
          <form method="POST" action="{% url 'comment_delete' pk=comment.pk %}">
            {% csrf_token %}
            <input type="submit" value="Delete" class="btn btn-danger" />
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>




{% comment %} CREATE COMMENT {% endcomment %}
  <h1>Tell us about your experience at this restaurant !</h1>
  <form method="POST" action="{% url 'restaurant_detail' pk=restaurant.pk %}">
    {% csrf_token %}
    {{form|crispy}}
    <input type="submit" value="Add comment" class="btn btn-primary" />
  </form>

  {% endblock %}
