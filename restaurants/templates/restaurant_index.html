{% extends "base.html" %}
{% load static %}
{% block page_content %}
{% load mathfilters %}

  <html>
    <body>
      <div class="container">
      <div class="row">
        <div class="col-lg-6 col-md-12 col-sm-12">
          <form method="GET" action="{% url 'search' %}">
            <div class="input-group">
              <input class="form-control"
                     type="search"
                     name="search"
                     placeholder="Craving a good slice?">
              <div class="input-group-append">
                <button class="btn btn-primary" type="submit">Search</button>
              </div>
            </div>
          </form>
          <div class="row row-cols-sm-3  row-cols-md-3 row-cols-lg-3">
            {% if all_search_results %}
              {% for restaurant in all_search_results %}
                <div class="mb-3">
                  <div class="card card-index">
                    <a href="{% url 'restaurant_detail' restaurant.pk %}">
                      {% if restaurant.image.url %}
                        <img class="card-img-top"
                             src="{{ restaurant.image.url }}"
                             alt="restaurant image">
                      {% else %}
                        <img class="card-img-top" src="{% static 'pizza.png' %}" alt="Restaurant default image">
                      {% endif %}
                      <div class="card-body">
                        <h5 class="card-title text-center overflow-hidden" style="height: 22px;">{{ restaurant.name|title }}</h5>
                        {% if restaurant.comments.last.margharitaindex %}
                        <p class="text-center" style="font-size:12px"> <i>Rating: {{ restaurant.average_quality|div:restaurant.comments.last.margharitaindex|floatformat:2 }}</i></p>
                        {% else %}
                        <p class="text-center" style="font-size:12px"> <i>To be rated</i></p>
                      {% endif %}
                        <p class="card-text text-justify overflow-hidden"
                           style="height: 5rem;
                                  font-size:12px">{{ restaurant.description|capfirst }}</p>
                      </div>
                    </a>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              {% for restaurant in restaurants %}
                <div class=" mb-3">
                  <div class="card card-index">
                    <a href="{% url 'restaurant_detail' restaurant.pk %}">
                      {% if restaurant.image.url %}
                        <img class="card-img-top"
                             src="{{ restaurant.image.url }}"
                             alt="restaurant image">
                      {% else %}
                        <img class="card-img-top" src="{% static 'pizza.png' %}" alt="Restaurant default image">
                      {% endif %}
                      <div class="card-body">
                        <h5 class="card-title text-center overflow-hidden" style="height: 22px;">{{ restaurant.name|title }}</h5>
                        {% if restaurant.comments.last.margharitaindex %}
                        <p class="text-center" style="font-size:12px"> <i>Rating: {{ restaurant.average_quality|div:restaurant.comments.last.margharitaindex|floatformat:2 }}</i></p>
                        {% else %}
                        <p class="text-center" style="font-size:12px"> <i>To be rated</i></p>
                      {% endif %}
                        <p class="card-text text-justify overflow-hidden"
                           style="height: 5rem;
                                  font-size:12px">{{ restaurant.description|capfirst }}</p>
                      </div>
                    </a>
                  </div>
                </div>
              {% endfor %}
            {% endif %}
          </div>
          <div class="text-center mt-4">
            {% if user.is_authenticated %}
              <a href="{% url 'restaurant_create' %}" class="btn btn-secondary mb-4">Add a restaurant</a>
            {% else %}
              <p>
                <a href="{% url 'register' %}">Sign up</a> or <a href="{% url 'login' %}">Sign in</a>
                to rate a restaurant!
              </p>
            {% endif %}
            <div id="app">
              <button class="btn btn-secondary story" @click="togglePopup">Or read our story...</button>
              <div class="popup"
                   :class="{ 'show': PopupStatus }"
                   @click="closePopupOutside">
                <div class="popup-content" @click.stop>
                  <span class="close-icon" @click="closePopup">Ã—</span>
                  <p>
                    The idea with this website was to have a simple app that would allow me to store and rate all the pizzas I tried during my stay in New Haven, CT, so that I would be able to decide which one was the very best at the end of my stay. Don't hesitate to fork the repo if you want to build yourself a similar website!
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 col-md-0 col-sm-0">
          <div id="map"
               style="height:96vh"
               class="map-index"
               data-restaurants-names="{{ restaurants_names }}"
               data-favicon-url="{% static "favicon.ico" %}"
               data-mapbox-access-token="{{ MAPBOX_ACCESS_TOKEN }}"
               data-restaurants-addresses="{{ restaurants_addresses }}"
               data-restaurants-indexes="{{ restaurants_indexes }}"></div>
          <script src="{% static "map_index.js" %}"></script>
        </div>
      </div>
    </div>
      <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
      <script src="{% static "vue.js" %}"></script>
    </body>
  </html>
{% endblock %}
